<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Data science: ggplot and model fitting</title>
  
  <meta property="description" itemprop="description" content="Plotting with ggplot and fitting statistical models"/>
  
  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
  
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Data science: ggplot and model fitting"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Plotting with ggplot and fitting statistical models"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Data science"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Data science: ggplot and model fitting"/>
  <meta property="twitter:description" content="Plotting with ggplot and fitting statistical models"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","output","editor_options"]}},"value":[{"type":"character","attributes":{},"value":["ggplot and model fitting"]},{"type":"character","attributes":{},"value":["Plotting with ggplot and fitting statistical models"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["radix::radix_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.radix-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .radix-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #455a64;
    font-size: 15px;
    font-weight: 300;
  }
  
  .radix-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .radix-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .radix-site-nav {
      display: none;
    }
  }
  
  .radix-site-header {
  
  }
  
  .radix-site-footer {
  
  }
  
  
  /* Site Header */
  
  .radix-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .radix-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .radix-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .radix-site-header a,
  .radix-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .radix-site-header .title {
    font-size: 18px;
  }
  
  .radix-site-header .logo {
    padding: 0;
  }
  
  .radix-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .radix-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .radix-site-header .logo img {
      display: inline-block;
    }
    .radix-site-header .nav-left {
      margin-left: 20px;
    }
    .radix-site-header .nav-right {
      margin-right: 20px;
    }
    .radix-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .radix-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header a, .radix-site-header .nav-dropdown  {display: none;}
    .radix-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .radix-site-header .title {
      margin-left: 0;
    }
    .radix-site-header .nav-right {
      margin-right: 0;
    }
    .radix-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .radix-site-header.responsive {position: relative;}
    .radix-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .radix-site-header.responsive a,
    .radix-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .radix-site-header.responsive .nav-left,
    .radix-site-header.responsive .nav-right {
      width: 100%;
    }
    .radix-site-header.responsive .nav-dropdown {float: none;}
    .radix-site-header.responsive .nav-dropdown-content {position: relative;}
    .radix-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .radix-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  </style>
  
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.radix-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
  <script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134721506-5"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-134721506-5');
  </script>
  <style type="text/css">
  .radix-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #383838;
    font-size: 15px;
    font-weight: 300;
  }
  
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"ggplot and model fitting","description":"Plotting with ggplot and fitting statistical models","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="radix-site-nav radix-site-header">
<div class="nav-left">
<a href="index.html" class="title">Data science</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="https://www.hauselin.com/about/">About me</a>
<a href="http://escal.site">Effect size converter</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Tutorials
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="0000_install.html">Install R and packages</a>
<a href="0001_rbasics.html">R programming basics</a>
<a href="0002_tidyverse_datatable.html">tidyverse and data.table</a>
<a href="0003_ggplot_modelfitting.html">ggplot and model fitting</a>
<a href="0004_dataform_join.html">long/wide form data and joining</a>
<a href="0005_analyze_multi_subject_trial_data.html">analyze multi-subject/trial RT data</a>
</div>
</div>
<a href="articles.html">Articles</a>
<a href="https://donorbox.org/support-my-teaching">Donate</a>
<a href="https://twitter.com/hauselin">
<i class="fab fa-twitter"></i>
</a>
<a href="https://github.com/hauselin/rtutorialsite">
<i class="fab fa-github"></i>
</a>
<a href="https://scholar.google.ca/citations?user=4_ZopI0AAAAJ&amp;hl=en">
<i class="fab fa-google"></i>
</a>
<a href="articles.xml">
<i class="fa fa-rss"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>ggplot and model fitting</h1>
<p>Plotting with ggplot and fitting statistical models</p>
</div>


<div class="d-article">
<h3 class="d-toc-header">Table of Contents</h3>
<nav class="d-toc" id="TOC">
<ul>
<li><a href="#consider-being-a-patron-and-supporting-my-work">Consider being a patron and supporting my work?</a></li>
<li><a href="#load-packageslibraries">Load packages/libraries</a></li>
<li><a href="#read-data-from-folderdirectory-into-r">Read data from folder/directory into R</a></li>
<li><a href="#ggplot2-basics-layering"><code>ggplot2</code> basics: layering</a><ul>
<li><a href="#layer-1-specify-data-object-axes-and-grouping-variables">Layer 1: specify data object, axes, and grouping variables</a></li>
<li><a href="#subsequent-layers-add-data-points-and-everything-else">Subsequent layers: add data points and everything else</a></li>
</ul></li>
<li><a href="#save-the-plot-as-an-object">Save the plot as an object</a></li>
<li><a href="#save-a-plot-to-your-directory">Save a plot to your directory</a></li>
<li><a href="#add-line-of-best-fit">Add line of best fit</a></li>
<li><a href="#grouping">Grouping</a><ul>
<li><a href="#use-col-to-specify-grouping-variable">Use <code>col</code> to specify grouping variable</a></li>
<li><a href="#use-shape-to-specify-grouping-variable">Use <code>shape</code> to specify grouping variable</a></li>
<li><a href="#adding-an-overall-line-of-best-fit-while-ignoring-class">Adding an overall line of best fit while ignoring class</a></li>
<li><a href="#adding-an-overall-line-of-best-fit-and-separate-lines-for-each-group">Adding an overall line of best fit AND separate lines for each group</a></li>
</ul></li>
<li><a href="#plotting-histograms-boxplots-and-violinplots">Plotting histograms, boxplots, and violinplots</a></li>
<li><a href="#distribution-of-points-with-geom_quasirandom">Distribution of points with <code>geom_quasirandom()</code></a></li>
<li><a href="#summary-statistics-with-ggplot2">Summary statistics with ggplot2</a></li>
<li><a href="#facets-for-grouping-facet_wrap-and-facet_grid">Facets for grouping: <code>facet_wrap()</code> and <code>facet_grid()</code></a></li>
<li><a href="#fitting-linear-models-general-linear-model-framework">Fitting linear models (general linear model framework)</a><ul>
<li><a href="#model-specification-in-r">Model specification in R</a></li>
<li><a href="#reference-groups-and-releveling-changing-reference-group">Reference groups and releveling (changing reference group)</a></li>
<li><a href="#specify-interactions">Specify interactions</a></li>
<li><a href="#fitting-anova-with-anova-and-aov">Fitting ANOVA with <code>anova</code> and <code>aov</code></a></li>
<li><a href="#specify-contrasts-resources">Specify contrasts resources</a></li>
<li><a href="#post-hoc-tests-resources">Post-hoc tests resources</a></li>
<li><a href="#plotting-and-testing-simple-effects-when-you-have-interactions">Plotting and testing simple effects when you have interactions</a></li>
<li><a href="#fit-t-test-with-t.test">Fit t-test with <code>t.test()</code></a></li>
<li><a href="#linear-mixed-effects-aka.-multi-level-or-hierarchical-models-with-lmer-from-the-lme4-package">Linear mixed effects (aka. multi-level or hierarchical) models with <code>lmer()</code> from the <code>lme4</code> package</a></li>
<li><a href="#more-multi-level-model-resources">More multi-level model resources</a></li>
</ul></li>
<li><a href="#manova">MANOVA</a><ul>
<li><a href="#computing-between--and-within-subjects-error-bars-also-between-within-designs">Computing between- and within-subjects error bars (also between-within designs)</a></li>
</ul></li>
<li><a href="#support-my-work">Support my work</a></li>
</ul>
</nav>
<hr class="d-toc-separator"/>
<p>Get source code for this RMarkdown script <a href="https://github.com/hauselin/rtutorialsite/blob/master/0003_ggplot_modelfitting.Rmd">here</a>.</p>
<h2 id="consider-being-a-patron-and-supporting-my-work">Consider being a patron and supporting my work?</h2>
<p><a href="https://donorbox.org/support-my-teaching">Donate and become a patron</a>: If you find value in what I do and have learned something from my site, please consider becoming a patron. It takes me many hours to research, learn, and put together tutorials. Your support really matters.</p>
<h2 id="load-packageslibraries">Load packages/libraries</h2>
<p>Use <code>library()</code> to load packages at the top of each R script.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(tidyverse); library(data.table); library(broom); library(dtplyr); 
library(lme4); library(lmerTest); library(ggbeeswarm); library(cowplot)
library(hausekeep)</code></pre>
</div>
<h2 id="read-data-from-folderdirectory-into-r">Read data from folder/directory into R</h2>
<p>Read in data from a csv file (stored in “./data/simpsonsParadox.csv”). Right-click to download and save the data <a href="https://raw.githubusercontent.com/hauselin/rtutorialsite/master/data/simpsonsParadox.csv">here</a>. You can also use the <code>fread()</code> function to read and download it directly from the URL (see code below).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df1 &lt;- fread(&quot;data/simpsonsParadox.csv&quot;) # data.table

# or download data directly from URL
url &lt;- &quot;https://raw.githubusercontent.com/hauselin/rtutorialsite/master/data/simpsonsParadox.csv&quot;
df1 &lt;- fread(url)

df1</code></pre>
<pre><code>
          iq  grades class
 1:  94.5128 67.9295     a
 2:  95.4359 82.5449     a
 3:  97.7949 69.0833     a
 4:  98.1026 83.3141     a
 5:  96.5641 99.0833     a
 6: 101.5897 89.8526     a
 7: 100.8718 73.6987     a
 8:  97.0769 47.9295     a
 9:  94.2051 55.6218     a
10:  94.4103 44.4679     a
11: 103.7436 74.0833     b
12: 102.8205 59.8526     b
13: 101.5897 47.9295     b
14: 105.3846 44.8526     b
15: 106.4103 60.2372     b
16: 109.4872 64.8526     b
17: 107.2308 74.4679     b
18: 107.2308 49.8526     b
19: 102.1026 37.9295     b
20: 100.0513 54.8526     b
21: 111.0256 56.0064     c
22: 114.7179 56.0064     c
23: 112.2564 46.3910     c
24: 108.6667 43.6987     c
25: 110.5128 36.3910     c
26: 114.1026 30.2372     c
27: 115.0256 39.4679     c
28: 118.7179 51.0064     c
29: 112.8718 64.0833     c
30: 118.0000 55.3000     c
31: 116.9744 17.5449     d
32: 121.1795 35.2372     d
33: 117.6923 29.8526     d
34: 121.8974 18.3141     d
35: 123.6410 29.4679     d
36: 121.3846 53.6987     d
37: 123.7436 63.6987     d
38: 124.7692 48.6987     d
39: 124.8718 38.3141     d
40: 127.6410 51.7756     d
          iq  grades class</code></pre>
<pre class="r"><code>
glimpse(df1)</code></pre>
<pre><code>
Observations: 40
Variables: 3
$ iq     &lt;dbl&gt; 94.5128, 95.4359, 97.7949, 98.1026, 96.5641, 101.5897, 100.871…
$ grades &lt;dbl&gt; 67.9295, 82.5449, 69.0833, 83.3141, 99.0833, 89.8526, 73.6987,…
$ class  &lt;chr&gt; &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;, &quot;b…</code></pre>
</div>
<h2 id="ggplot2-basics-layering"><code>ggplot2</code> basics: layering</h2>
<p><code>ggplot2</code> produces figures by adding layers one at a time. New layers are added using the + sign. The first line is the first/bottom-most layer, and second line is on top of the bottom layer, and third line is on top of the second layer, and the last line of code is the top-most layer.</p>
<p>See <a href="http://ggplot2.tidyverse.org/">official documentation here</a>.</p>
<p>Note: ggplot prefers long-form (tidy) data.</p>
<h3 id="layer-1-specify-data-object-axes-and-grouping-variables">Layer 1: specify data object, axes, and grouping variables</h3>
<p>Use <code>ggplot</code> function (not <code>ggplot2</code>, which is the name of the library, not a function!). Plot iq on x-axis and grades on y-axis.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(data = df1, aes(x = iq, y = grades)) # see Plots panel (empty plot with correct axis labels)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<h3 id="subsequent-layers-add-data-points-and-everything-else">Subsequent layers: add data points and everything else</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + # also works without specifying data, x, and y
    geom_point() # add points</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>Each time you want to know more about a <code>ggplot2</code> function, google <strong>ggplot2 function_name</strong> to see official documentation and examples and learn those examples! That’s usually how we plot figures. Even <a href="http://hadley.nz/">Hadley Wickham</a>, the creator of <code>tidyverse</code> and many many cool things in R refers to his own online documentations all the time. There are way too many things for everyone to remember, and we usually just look them up on the internet whenever we need to use them (e.g., google <strong>ggplot2 geom point</strong>).</p>
<p>You’ll use <code>geom_point()</code> most frequently to add points to your plots. Check out the official documentation for <code>geom_point</code> <a href="http://ggplot2.tidyverse.org/reference/geom_point.html">here</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 8, col = &#39;green&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) # rename axes</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 3, col = &#39;blue&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) # x axis limits/range</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<h2 id="save-the-plot-as-an-object">Save the plot as an object</h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
plot1 &lt;- ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 3, col = &#39;red&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) # x axis limits/range
plot1 # print plot</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<h2 id="save-a-plot-to-your-directory">Save a plot to your directory</h2>
<p>Save to Figures directory, assuming this directory/folder already exists. You can also change the width/height of your figure and dpi (resolution/quality) of your figure (journals usually expect around 300 dpi).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggsave(plot1, &#39;./Figures/iq_grades.png&#39;, width = 10, heigth = 10, dpi = 100)</code></pre>
</div>
<h2 id="add-line-of-best-fit">Add line of best fit</h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
plot1 + 
    geom_smooth() # fit line to data (defaults loess smoothing)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<p>Same as above</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 3, col = &#39;red&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<p>Note that the smooth (i.e., the line of best fit) is on top of the dots, because of layering. Let’s add the line first, then use <code>geom_point()</code>. What do you think will happen?</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_smooth(size = 2) +
    geom_point(size = 3, col = &#39;red&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;, title = &#39;Changed layers&#39;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130))# x axis limits/range </code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<p>Note that now the points are above the line. Also, I’ve added a title via the <code>labs()</code> line.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 3, col = &#39;red&#39;) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F, col = &#39;black&#39;) # fit linear regression line, remove standard error, black line</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>Why is IQ negatively correlated with grades?</p>
<h2 id="grouping">Grouping</h2>
<h3 id="use-col-to-specify-grouping-variable">Use <code>col</code> to specify grouping variable</h3>
<p>Note what’s new in the first line/layer to add grouping.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades, col = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) # fit linear regression line </code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-12-1.png" width="624" /></p>
</div>
<p><code>ggplot(df1, aes(iq, grades, col = class))</code> specifies the data to plot <code>df1</code>, x-axis <code>iq</code>, y-axis <code>grades</code>, and to give different colours to different groups <code>col = class</code>, where <code>class</code> refers to the grouping variable in the dataset.</p>
<p>What is the relationship between IQ and grades within each class now? What happened?!?</p>
<h3 id="use-shape-to-specify-grouping-variable">Use <code>shape</code> to specify grouping variable</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades, shape = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) # fit linear regression line </code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<h3 id="adding-an-overall-line-of-best-fit-while-ignoring-class">Adding an overall line of best fit while ignoring class</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades, col = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F, aes(group = 1)) # fit linear regression line </code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-14-1.png" width="624" /></p>
</div>
<h3 id="adding-an-overall-line-of-best-fit-and-separate-lines-for-each-group">Adding an overall line of best fit AND separate lines for each group</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
plot2 &lt;- ggplot(df1, aes(iq, grades, col = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) + # fit linear regression line 
    geom_smooth(method = &#39;lm&#39;, se = F, aes(group = 1))
plot2</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-15-1.png" width="624" /></p>
</div>
<p><a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s paradox</a>: Negative overall relationship, but positive relationship within each class.</p>
<h2 id="plotting-histograms-boxplots-and-violinplots">Plotting histograms, boxplots, and violinplots</h2>
<p>Histogram</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq)) +
    geom_histogram()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-16-1.png" width="624" /></p>
</div>
<p>Specifying binwidth</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq)) +
    geom_histogram(binwidth = 5)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>Density plot</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq)) +
    geom_density()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<p>Boxplot for each class</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, grades)) +
    geom_boxplot()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<p>Violinplot for each class</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, grades)) +
    geom_violin()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-20-1.png" width="624" /></p>
</div>
<p>Layering and colouring plots</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, grades, col = class)) +
    geom_violin() +
    geom_boxplot() +
    geom_point()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<h2 id="distribution-of-points-with-geom_quasirandom">Distribution of points with <code>geom_quasirandom()</code></h2>
<p>An alternative that I prefer more than both boxplots and violin plots: <code>geom_quasirandom()</code> from the <code>ggbeeswarm</code> package. See <a href="https://github.com/eclarke/ggbeeswarm">here</a> for more information.</p>
<p><code>geom_quasirandom()</code> extends <code>geom_point()</code> by showing the distribution information at the same time. It basically combines all the good things in <code>geom_boxplot</code>, <code>geom_violin</code>, <code>geom_point</code> and <code>geom_histogram</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, grades, col = class)) +
    geom_quasirandom()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df1$overallClass &lt;- &quot;one_class&quot; # create variable that assigns everyone to one class
# df1[, overallClass := &quot;one_class&quot;] # data.table syntax for the line above</code></pre>
</div>
<p><code>geom_quasirandom</code> shows distribution information!</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(overallClass, grades)) + # y: grades
    geom_quasirandom()</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(overallClass, iq)) + # y: iq
    geom_quasirandom() +
    labs(x = &quot;&quot;) # remove x-axis label (compare with above)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<h2 id="summary-statistics-with-ggplot2">Summary statistics with ggplot2</h2>
<p><code>stat_summary()</code> can quickly help you compute summary statistics and plot them. If you get a warning message about Hmisc package, just install that package using <code>install.packages('Hmisc')</code> and then <code>library(Hmisc)</code></p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, iq)) + # y: iq
    geom_quasirandom(alpha = 0.3) +
    stat_summary(fun.y = mean, geom = &#39;point&#39;, size = 3) + # apply mean function to y axis (fun.y = mean)
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, width = 0, size = 1) # apply mean_cl_normal function to data</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<h2 id="facets-for-grouping-facet_wrap-and-facet_grid">Facets for grouping: <code>facet_wrap()</code> and <code>facet_grid()</code></h2>
<p>Randomly assign gender to each row (see previous tutorial for detailed explanation of the code below)</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df1$gender &lt;- sample(x = c(&quot;female&quot;, &quot;male&quot;), size = 40, replace = T)</code></pre>
</div>
<p>Code from before</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<p>Using facets instead of <code>col = class</code>. See the last line of code <code>facet_wrap()</code>.</p>
<p><code>facet_wrap()</code>: one facet per class</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_wrap(~class) # one facet per class</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-29-1.png" width="624" /></p>
</div>
<p><code>facet_wrap()</code>: one facet per class and gender</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_wrap(class~gender) # one facet per class and gender</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<p><code>facet_grid()</code>: one facet per gender</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_grid(.~gender) # one facet per gender</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-31-1.png" width="624" /></p>
</div>
<p><code>facet_grid()</code>: one facet per gender</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_grid(gender~.) # one facet per gender</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-32-1.png" width="624" /></p>
</div>
<p><code>facet_grid()</code>: one facet per class and gender</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_grid(gender~class) # one facet per gender</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<p><code>facet_grid()</code>: one facet per class and gender</p>
<p>Add variable name</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point(size = 2) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) +
    facet_grid(gender~class, labeller = label_both) # one facet per gender</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-34-1.png" width="624" /></p>
</div>
<h2 id="fitting-linear-models-general-linear-model-framework">Fitting linear models (general linear model framework)</h2>
<p>Fit a model to this this relationship</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades)) + 
    geom_point() +
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F, col = &#39;black&#39;) # fit linear regression line, remove standard error, black line</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-35-1.png" width="624" /></p>
</div>
<h3 id="model-specification-in-r">Model specification in R</h3>
<ul>
<li>most model fitting functions prefer long-form data (aka tidy data)</li>
<li>~ is the symbol for “prediction” (read: “predicted by”)</li>
<li>y ~ x: y predicted by x (y is outcome/dependent variable, x is predictor/independent variable)</li>
<li><code>lm(y ~ x, data)</code> is the most commonly-used and flexible function (linear model)</li>
<li>covariates and predictors are specified in the same way (unlike SPSS)</li>
</ul>
<p>Test the relationship in the plot above</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
modelLinear &lt;- lm(formula = iq ~ grades, data = df1)
summary(modelLinear) # get model results and p values</code></pre>
<pre><code>
Call:
lm(formula = iq ~ grades, data = df1)

Residuals:
     Min       1Q   Median       3Q      Max 
-17.7002  -4.9650   0.3856   6.0826  17.6721 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 125.14212    4.23923  29.520  &lt; 2e-16 ***
grades       -0.29306    0.07479  -3.919 0.000359 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 8.599 on 38 degrees of freedom
Multiple R-squared:  0.2878,    Adjusted R-squared:  0.2691 
F-statistic: 15.36 on 1 and 38 DF,  p-value: 0.0003592</code></pre>
<pre class="r"><code>
summaryh(modelLinear) # generates APA-formmatted results</code></pre>
<pre><code>
          term                                                  results
1: (Intercept) b = 125.14, SE = 4.24, t(38) = 29.52, p &lt; .001, r = 0.98
2:      grades  b = −0.29, SE = 0.07, t(38) = −3.92, p &lt; .001, r = 0.54</code></pre>
</div>
<p>Note the significant negative relationship between iq and grades.</p>
<p>Since we know that class “moderates” the effect between iq and grades, let’s “control” for class by adding <code>class</code> into the model specification.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades, col = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) + # fit linear regression line 
    geom_smooth(method = &#39;lm&#39;, se = F, aes(group = 1))</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-37-1.png" width="624" /></p>
</div>
<p>Test the relationship above by “controlling” for class</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
modelLinear_class &lt;- lm(iq ~ grades + class, data = df1)
summary(modelLinear_class) # get model results and p values</code></pre>
<pre><code>
Call:
lm(formula = iq ~ grades + class, data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.5552 -2.2276 -0.1403  2.0785  4.8499 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 90.74793    2.48240  36.557  &lt; 2e-16 ***
grades       0.08841    0.03251   2.720   0.0101 *  
classb       8.82731    1.33606   6.607 1.24e-07 ***
classc      18.61047    1.46538  12.700 1.15e-14 ***
classd      28.21349    1.64119  17.191  &lt; 2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 2.796 on 35 degrees of freedom
Multiple R-squared:  0.9306,    Adjusted R-squared:  0.9227 
F-statistic: 117.4 on 4 and 35 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>
summaryh(modelLinear_class)</code></pre>
<pre><code>
          term                                                 results
1: (Intercept) b = 90.75, SE = 2.48, t(35) = 36.56, p &lt; .001, r = 0.99
2:      grades   b = 0.09, SE = 0.03, t(35) = 2.72, p = .010, r = 0.42
3:      classb   b = 8.83, SE = 1.34, t(35) = 6.61, p &lt; .001, r = 0.74
4:      classc b = 18.61, SE = 1.47, t(35) = 12.70, p &lt; .001, r = 0.91
5:      classd b = 28.21, SE = 1.64, t(35) = 17.19, p &lt; .001, r = 0.95</code></pre>
</div>
<p>Note the significantly positive relationship between iq and grades now.</p>
<h3 id="reference-groups-and-releveling-changing-reference-group">Reference groups and releveling (changing reference group)</h3>
<p>R automatically recodes categorical/factor variables into 0s and 1s (i.e., dummy-coding). Alphabets/letters/characters/numbers that come first (a comes before b) will be coded 0, and those that follow will be coded 1.</p>
<p>In our case, class “a” has been coded 0 (reference group) and all other classes (“b”, “c”, “d”) are contrasted against it, hence you have 3 other effects (“classb”, “classc”, “classd”) that reflect the difference between class “a” and each of the other classes.</p>
<p>To change reference group, use <code>as.factor()</code> and <code>relevel()</code></p>
<p>To change reference groups, you first have to convert your grouping variable to <code>factor</code> class, which explicitly tells R your variable is a categorical/factor variable. Then use <code>relevel()</code> to change the reference group.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df1$class &lt;- relevel(as.factor(df1$class), ref = &quot;d&quot;)
levels(df1$class) # check reference levels (d is now the reference/first group)</code></pre>
<pre><code>
[1] &quot;d&quot; &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<pre class="r"><code>
summaryh(lm(iq ~ grades + class, data = df1)) # quickly fit model and look at outcome (no assignment to object)</code></pre>
<pre><code>
          term                                                   results
1: (Intercept)  b = 118.96, SE = 1.54, t(35) = 77.41, p &lt; .001, r = 1.00
2:      grades     b = 0.09, SE = 0.03, t(35) = 2.72, p = .010, r = 0.42
3:      classa b = −28.21, SE = 1.64, t(35) = −17.19, p &lt; .001, r = 0.95
4:      classb b = −19.39, SE = 1.38, t(35) = −14.01, p &lt; .001, r = 0.92
5:      classc   b = −9.60, SE = 1.29, t(35) = −7.47, p &lt; .001, r = 0.78</code></pre>
</div>
<h3 id="specify-interactions">Specify interactions</h3>
<ul>
<li>y predicted by x1, x2, and their interactions: y ~ x1 + x2 + x1:x2</li>
<li>concise expression: y ~ x1 * x2 (includes all main effects and interaction)</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
modelLinear_interact &lt;- lm(iq ~ grades + class + grades:class, data = df1)
summary(modelLinear_interact)</code></pre>
<pre><code>
Call:
lm(formula = iq ~ grades + class + grades:class, data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.6623 -2.3238 -0.2229  1.9845  4.9309 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   117.56287    2.57958  45.574  &lt; 2e-16 ***
grades          0.12459    0.06237   1.998  0.05433 .  
classa        -25.29661    4.70506  -5.376 6.64e-06 ***
classb        -18.39902    5.29099  -3.477  0.00148 ** 
classc         -6.97275    5.18349  -1.345  0.18802    
grades:classa  -0.05745    0.08226  -0.698  0.48993    
grades:classb  -0.02894    0.10111  -0.286  0.77653    
grades:classc  -0.06191    0.11112  -0.557  0.58131    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 2.898 on 32 degrees of freedom
Multiple R-squared:  0.9319,    Adjusted R-squared:  0.917 
F-statistic: 62.52 on 7 and 32 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>
summaryh(modelLinear_interact)</code></pre>
<pre><code>
            term                                                  results
1:   (Intercept) b = 117.56, SE = 2.58, t(32) = 45.57, p &lt; .001, r = 0.99
2:        grades    b = 0.12, SE = 0.06, t(32) = 2.00, p = .054, r = 0.33
3:        classa b = −25.30, SE = 4.71, t(32) = −5.38, p &lt; .001, r = 0.69
4:        classb b = −18.40, SE = 5.29, t(32) = −3.48, p = .002, r = 0.52
5:        classc  b = −6.97, SE = 5.18, t(32) = −1.35, p = .188, r = 0.23
6: grades:classa  b = −0.06, SE = 0.08, t(32) = −0.70, p = .490, r = 0.12
7: grades:classb  b = −0.03, SE = 0.10, t(32) = −0.29, p = .776, r = 0.05
8: grades:classc  b = −0.06, SE = 0.11, t(32) = −0.56, p = .581, r = 0.10</code></pre>
</div>
<h4 id="intercept-only-model">Intercept-only model</h4>
<p>R uses <code>1</code> to refer to the intercept</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
modelLinear_intercept &lt;- lm(iq ~ 1, data = df1) # mean iq
# summaryh(modelLinear_intercept)
df1[, mean(iq)] # matches the intercept term</code></pre>
<pre><code>
[1] 109.4077</code></pre>
<pre class="r"><code>
mean(df1$iq) # same as above</code></pre>
<pre><code>
[1] 109.4077</code></pre>
</div>
<p>Remove intercept from model (if you ever need to do so…) by specifying <code>-1</code></p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
modelLinear_noIntercept &lt;- lm(iq ~ grades - 1, data = df1) # substract intercept
summary(modelLinear_noIntercept)</code></pre>
<pre><code>
Call:
lm(formula = iq ~ grades - 1, data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-81.586  -6.131  14.935  35.214  88.969 

Coefficients:
       Estimate Std. Error t value Pr(&gt;|t|)    
grades   1.7980     0.1158   15.52   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 41.52 on 39 degrees of freedom
Multiple R-squared:  0.8607,    Adjusted R-squared:  0.8571 
F-statistic:   241 on 1 and 39 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>
# summaryh(modelLinear_noIntercept)</code></pre>
</div>
<h3 id="fitting-anova-with-anova-and-aov">Fitting ANOVA with <code>anova</code> and <code>aov</code></h3>
<p>By default, R uses Type I sum of squares.</p>
<p>Let’s test this model with ANOVA.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, iq)) + # y: iq
    geom_quasirandom(alpha = 0.3) +
    stat_summary(fun.y = mean, geom = &#39;point&#39;, size = 3) + # apply mean function to y axis (fun.y = mean)
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, width = 0, size = 1) # apply mean_cl_normal function to data</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-43-1.png" width="624" /></p>
</div>
<p>Note that class d comes first because we releveled it earlier on (we changed the reference group to d).</p>
<p>Fit ANOVA with <code>aov()</code></p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
anova_class &lt;- aov(grades ~ class, data = df1)
summary(anova_class)</code></pre>
<pre><code>
            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
class        3   5821  1940.4    9.44 9.73e-05 ***
Residuals   36   7400   205.6                     
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<p>Class * gender interaction (and main effects)</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, iq, col = gender)) + # y: iq
    geom_quasirandom(alpha = 0.3, dodge = 0.5) +
    stat_summary(fun.y = mean, geom = &#39;point&#39;, size = 3, position = position_dodge(0.5)) + 
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, 
                 width = 0, size = 1, position = position_dodge(0.5))</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-45-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
anova_classGender &lt;- aov(grades ~ class * gender, data = df1)
anova_classGender</code></pre>
<pre><code>
Call:
   aov(formula = grades ~ class * gender, data = df1)

Terms:
                   class   gender class:gender Residuals
Sum of Squares  5821.086   45.297      170.318  7184.348
Deg. of Freedom        3        1            3        32

Residual standard error: 14.98369
Estimated effects may be unbalanced</code></pre>
</div>
<h3 id="specify-contrasts-resources">Specify contrasts resources</h3>
<ul>
<li><a href="https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/">UCLA site</a>.</li>
<li><a href="https://rstudio-pubs-static.s3.amazonaws.com/65059_586f394d8eb84f84b1baaf56ffb6b47f.html">another tutorial</a></li>
</ul>
<h3 id="post-hoc-tests-resources">Post-hoc tests resources</h3>
<ul>
<li><a href="https://stats.idre.ucla.edu/r/faq/how-can-i-do-post-hoc-pairwise-comparisons-in-r/">UCLA site</a></li>
</ul>
<h3 id="plotting-and-testing-simple-effects-when-you-have-interactions">Plotting and testing simple effects when you have interactions</h3>
<ul>
<li><code>sjPlot</code> package: see <a href="http://www.strengejacke.de/sjPlot/">here</a></li>
<li><a href="https://jtools.jacob-long.com/">more tutorial and packages</a></li>
</ul>
<h3 id="fit-t-test-with-t.test">Fit t-test with <code>t.test()</code></h3>
<p>Fit models for this figure</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(class, iq, col = gender)) + # y: iq
    geom_quasirandom(alpha = 0.3, dodge = 0.5) +
    stat_summary(fun.y = mean, geom = &#39;point&#39;, size = 3, position = position_dodge(0.5)) + 
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, 
                 width = 0, size = 1, position = position_dodge(0.5))</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-47-1.png" width="624" /></p>
</div>
<p>Gender effect</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ttest_gender &lt;- t.test(iq ~ gender, data = df1)
ttest_gender</code></pre>
<pre><code>
    Welch Two Sample t-test

data:  iq by gender
t = 1.0552, df = 36.923, p-value = 0.2982
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -3.088961  9.801220
sample estimates:
mean in group female   mean in group male 
            111.2536             107.8974 </code></pre>
<pre class="r"><code>
summaryh(ttest_gender)</code></pre>
<pre><code>
                            results
1: t(37) = 1.06, p = .298, r = 0.17</code></pre>
</div>
<p>class a vs. class d</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ttest_classAD &lt;- t.test(iq ~ class, data = df1[class %in% c(&quot;a&quot;, &quot;d&quot;)]) # data.table subsetting
ttest_classAD</code></pre>
<pre><code>
    Welch Two Sample t-test

data:  iq by class
t = 19.105, df = 17.128, p-value = 5.488e-13
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 22.52811 28.11803
sample estimates:
mean in group d mean in group a 
      122.37948        97.05641 </code></pre>
<pre class="r"><code>
summaryh(ttest_classAD, showTable = T) # show all other effect sizes</code></pre>
<pre><code>
$results
                             results
1: t(17) = 19.10, p &lt; .001, r = 0.98

$results2
          term     df statistic p.value  es.r  es.d
1: iq by class 17.128    19.105       0 0.977 9.233</code></pre>
</div>
<h3 id="linear-mixed-effects-aka.-multi-level-or-hierarchical-models-with-lmer-from-the-lme4-package">Linear mixed effects (aka. multi-level or hierarchical) models with <code>lmer()</code> from the <code>lme4</code> package</h3>
<p>Rather than “control” for class when fitting models to test the relationship between iq and grades below, we can use multi-level models to specify nesting within the data. See <a href="http://mfviz.com/hierarchical-models/">here</a> for beautiful visual introduction to multi-level models.</p>
<p>Another function is <code>nlme()</code> from the <code>lme</code> package. We use both <code>nlme()</code> and <code>lmer()</code>, depending on our needs.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(df1, aes(iq, grades, col = class)) + 
    geom_point(size = 3) + # change size and colour
    labs(y = &quot;Exam grades (0 to 100)&quot;, x = &quot;Intelligence (IQ)&quot;) + # rename axes
    scale_y_continuous(limits = c(0, 100), breaks = c(0, 20, 40, 60, 80, 100)) + # y axis limits/range (0, 100), break points
    scale_x_continuous(limits = c(90, 130)) + # x axis limits/range 
    geom_smooth(method = &#39;lm&#39;, se = F) + # fit linear regression line 
    geom_smooth(method = &#39;lm&#39;, se = F, aes(group = 1))</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-50-1.png" width="624" /></p>
</div>
<p>Model specification with <code>lmer()</code></p>
<ul>
<li>y ~ x (same as other models)</li>
<li>(1 | group): varying intercept (one intercept per group)</li>
<li>(1 + x | group): varying intercept and slope (one intercept and slope per group)</li>
</ul>
<h4 id="random-intercept-model-fixed-slope">Random intercept model (fixed slope)</h4>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
m_intercept &lt;- lmer(grades ~ iq + (1 | class), data = df1)
summary(m_intercept)</code></pre>
<pre><code>
Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: grades ~ iq + (1 | class)
   Data: df1

REML criterion at convergence: 326

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.71343 -0.79565  0.03888  0.56708  2.18979 

Random effects:
 Groups   Name        Variance Std.Dev.
 class    (Intercept) 895.7    29.93   
 Residual             176.6    13.29   
Number of obs: 40, groups:  class, 4

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)  
(Intercept) -100.7438    74.1321   27.4656  -1.359   0.1852  
iq             1.4116     0.6634   31.3445   2.128   0.0413 *
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
   (Intr)
iq -0.979</code></pre>
<pre class="r"><code>
summaryh(m_intercept)</code></pre>
<pre><code>
          term                                                    results
1: (Intercept) b = −100.74, SE = 74.13, t(27) = −1.36, p = .185, r = 0.25
2:          iq      b = 1.41, SE = 0.66, t(31) = 2.13, p = .041, r = 0.36</code></pre>
<pre class="r"><code>
coef(m_intercept) # check coefficients for each class</code></pre>
<pre><code>
$class
  (Intercept)      iq
d  -133.43968 1.41155
a   -66.32624 1.41155
b   -90.95738 1.41155
c  -112.25181 1.41155

attr(,&quot;class&quot;)
[1] &quot;coef.mer&quot;</code></pre>
</div>
<p>By accounting for nesting within class, the relationship between iq and grades is positive!</p>
<h4 id="random-intercept-and-slope-model">Random intercept and slope model</h4>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
m_interceptSlope &lt;- lmer(grades ~ iq + (1 + iq | class), data = df1)
summary(m_interceptSlope)</code></pre>
<pre><code>
Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: grades ~ iq + (1 + iq | class)
   Data: df1

REML criterion at convergence: 326

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.71504 -0.77488  0.03495  0.57017  2.20283 

Random effects:
 Groups   Name        Variance  Std.Dev. Corr
 class    (Intercept)  51.20361  7.1557      
          iq            0.04541  0.2131  0.99
 Residual             176.32034 13.2786      
Number of obs: 40, groups:  class, 4

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)  
(Intercept) -102.4819    72.9541   30.3777  -1.405   0.1702  
iq             1.4427     0.6779   11.7465   2.128   0.0552 .
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
   (Intr)
iq -0.978
convergence code: 0
Model failed to converge with max|grad| = 0.0391438 (tol = 0.002, component 1)</code></pre>
<pre class="r"><code>
summaryh(m_interceptSlope)</code></pre>
<pre><code>
          term                                                    results
1: (Intercept) b = −102.48, SE = 72.95, t(30) = −1.40, p = .170, r = 0.25
2:          iq      b = 1.44, SE = 0.68, t(12) = 2.13, p = .055, r = 0.53</code></pre>
<pre class="r"><code>
coef(m_interceptSlope) # check coefficients for each class</code></pre>
<pre><code>
$class
  (Intercept)       iq
d  -109.95237 1.219693
a   -93.98509 1.696469
b  -100.47154 1.502764
c  -105.51844 1.352012

attr(,&quot;class&quot;)
[1] &quot;coef.mer&quot;</code></pre>
</div>
<h4 id="random-slope-model-fixed-intercept">Random slope model (fixed intercept)</h4>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
m_slope &lt;- lmer(grades ~ iq + (0 + iq | class), data = df1)
summary(m_slope)</code></pre>
<pre><code>
Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: grades ~ iq + (0 + iq | class)
   Data: df1

REML criterion at convergence: 326

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.71468 -0.75940  0.02992  0.57630  2.20673 

Random effects:
 Groups   Name Variance  Std.Dev.
 class    iq     0.07826  0.2797 
 Residual      176.30897 13.2781 
Number of obs: 40, groups:  class, 4

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)  
(Intercept) -102.5810    72.8999   31.8200  -1.407   0.1691  
iq             1.4484     0.6854   27.8157   2.113   0.0437 *
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
   (Intr)
iq -0.979</code></pre>
<pre class="r"><code>
summaryh(m_slope)</code></pre>
<pre><code>
          term                                                    results
1: (Intercept) b = −102.58, SE = 72.90, t(32) = −1.41, p = .169, r = 0.24
2:          iq      b = 1.45, SE = 0.69, t(28) = 2.11, p = .044, r = 0.37</code></pre>
<pre class="r"><code>
coef(m_slope) # check coefficients for each class</code></pre>
<pre><code>
$class
  (Intercept)       iq
d    -102.581 1.159517
a    -102.581 1.784959
b    -102.581 1.523003
c    -102.581 1.326087

attr(,&quot;class&quot;)
[1] &quot;coef.mer&quot;</code></pre>
</div>
<h3 id="more-multi-level-model-resources">More multi-level model resources</h3>
<ul>
<li><a href="https://github.com/clayford/LMEMInR/blob/master/lme4_cheat_sheet.Rmd">what lmer (and lme) can do</a></li>
<li><a href="https://stats.stackexchange.com/questions/13166/rs-lmer-cheat-sheet">lmer cheatsheet on stackexchange</a></li>
<li><a href="http://rpsychologist.com/r-guide-longitudinal-lme-lmer">two/three level models</a></li>
</ul>
<h2 id="manova">MANOVA</h2>
<p>Let’s use a different dataset. <code>iris</code>, a famous dataset that comes with R. Type <code>?iris</code> in your console for more information about this dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
irisDT &lt;- as.data.table(iris) # convert to data.table and tibble
irisDT # wide form data</code></pre>
<pre><code>
     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
  1:          5.1         3.5          1.4         0.2    setosa
  2:          4.9         3.0          1.4         0.2    setosa
  3:          4.7         3.2          1.3         0.2    setosa
  4:          4.6         3.1          1.5         0.2    setosa
  5:          5.0         3.6          1.4         0.2    setosa
 ---                                                            
146:          6.7         3.0          5.2         2.3 virginica
147:          6.3         2.5          5.0         1.9 virginica
148:          6.5         3.0          5.2         2.0 virginica
149:          6.2         3.4          5.4         2.3 virginica
150:          5.9         3.0          5.1         1.8 virginica</code></pre>
</div>
<p>The dataset is in wide form. To visualize easily with <code>ggplot</code>, we need to convert it to long form (more on converting between forms) in future tutorials.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
gather(irisDT, meaureLength, length, -Species) %&gt;% # convert from wide to long form
    ggplot(aes(Species, length, col = meaureLength)) + # no need to specify data because of piping
    geom_quasirandom(alpha = 0.3, dodge = 0.5) </code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-55-1.png" width="624" /></p>
</div>
<p>MANOVA to test if species predicts length of sepal length and petal length?</p>
<figure>
<img src="attachments/sepalPetal.png" alt="Long to wide form" /><figcaption>Long to wide form</figcaption>
</figure>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
outcome &lt;- cbind(irisDT$Sepal.Length, irisDT$Petal.Length) # cbind (column bind)
manova_results &lt;- manova(outcome ~ Species, data = iris)
summary(manova_results) # manova results</code></pre>
<pre><code>
           Df Pillai approx F num Df den Df    Pr(&gt;F)    
Species     2 0.9885   71.829      4    294 &lt; 2.2e-16 ***
Residuals 147                                            
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>
summary.aov(manova_results) # see which outcome variables differ</code></pre>
<pre><code>
 Response 1 :
             Df Sum Sq Mean Sq F value    Pr(&gt;F)    
Species       2 63.212  31.606  119.26 &lt; 2.2e-16 ***
Residuals   147 38.956   0.265                      
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

 Response 2 :
             Df Sum Sq Mean Sq F value    Pr(&gt;F)    
Species       2 437.10 218.551  1180.2 &lt; 2.2e-16 ***
Residuals   147  27.22   0.185                      
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<h4 id="manova-resources">MANOVA resources</h4>
<ul>
<li><a href="https://rpubs.com/aaronsc32/manova">link 1</a></li>
<li><a href="https://www.statmethods.net/stats/anova.html">link 2</a></li>
<li><a href="http://www.sthda.com/english/wiki/manova-test-in-r-multivariate-analysis-of-variance">link 3</a></li>
</ul>
<h3 id="computing-between--and-within-subjects-error-bars-also-between-within-designs">Computing between- and within-subjects error bars (also between-within designs)</h3>
<p>Error bars for between- and within-subjects designs have to be calculated differently. There’s much debate on how to compute within-subjects this properly…</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
cw &lt;- as.data.table(ChickWeight) # convert built-in ChickWeight data to data.table and tibble</code></pre>
</div>
<p>data information</p>
<ul>
<li>ID variable: Chick (50 chicks)</li>
<li>outcome/dependent variable: weight (weight of Chick) (<strong>within</strong>-subjects variable)</li>
<li>predictor/indepedent variable: Diet (diet each Chick was assigned to) (<strong>between</strong>-subjects variable)</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
cw # weight of 50 chicks are different times, on different diets</code></pre>
<pre><code>
     weight Time Chick Diet
  1:     42    0     1    1
  2:     51    2     1    1
  3:     59    4     1    1
  4:     64    6     1    1
  5:     76    8     1    1
 ---                       
574:    175   14    50    4
575:    205   16    50    4
576:    234   18    50    4
577:    264   20    50    4
578:    264   21    50    4</code></pre>
<pre class="r"><code>
cw[, unique(Time)] # time points</code></pre>
<pre><code>
 [1]  0  2  4  6  8 10 12 14 16 18 20 21</code></pre>
<pre class="r"><code>
cw[, n_distinct(Chick)] # no. of Chicks</code></pre>
<pre><code>
[1] 50</code></pre>
<pre class="r"><code>
cw[, unique(Diet)] # Diets</code></pre>
<pre><code>
[1] 1 2 3 4
Levels: 1 2 3 4</code></pre>
</div>
<h4 id="between-subject-error-bars">Between-subject error bars</h4>
<p>Do different diets lead to different weights? Each chick is only assigned to one diet (rather than &gt; 1 diet), so we can use between-subjects error bars (or confidence intervals).</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(cw, aes(Diet, weight)) +
    geom_quasirandom(alpha = 0.3) + # this line plots raw data and can be omitted, depending on your plotting preferences
    stat_summary(fun.y = mean, geom = &#39;point&#39;, size = 5) + # compute mean and plot
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, width = 0, size = 1) # compute between-sub confidence intervals</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-59-1.png" width="624" /></p>
</div>
<h4 id="within-subject-error-bars">Within-subject error bars</h4>
<p>How does weight change over time (ignoring diet)? Each chick has multiple measurements of time, so we’ll use within-subjects error bars, which we have to calculate ourselves. Use <code>seWithin()</code> from the <code>hausekeep</code> package to compute within-subjects error bars.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
cw_weight_withinEB &lt;- seWithin(data = cw, measurevar = c(&quot;weight&quot;), 
                               withinvars = c(&quot;Time&quot;), idvar = &quot;Chick&quot;)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Time"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["N"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ci"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"50","3":"41.06000","4":"34.68062","5":"4.904580","6":"9.856123"},{"1":"2","2":"50","3":"49.22000","4":"33.12237","5":"4.684210","6":"9.413273"},{"1":"4","2":"49","3":"59.95918","4":"30.00113","5":"4.285876","6":"8.617331"},{"1":"6","2":"49","3":"74.30612","4":"26.56071","5":"3.794387","6":"7.629126"},{"1":"8","2":"49","3":"91.24490","4":"20.70396","5":"2.957709","6":"5.946873"},{"1":"10","2":"49","3":"107.83673","4":"15.34996","5":"2.192851","6":"4.409023"},{"1":"12","2":"49","3":"129.24490","4":"12.59951","5":"1.799931","6":"3.619003"},{"1":"14","2":"48","3":"143.81250","4":"13.08456","5":"1.888593","6":"3.799360"},{"1":"16","2":"47","3":"168.08511","4":"20.31087","5":"2.962645","6":"5.963495"},{"1":"18","2":"47","3":"190.19149","4":"30.93940","5":"4.512975","6":"9.084148"},{"1":"20","2":"46","3":"209.71739","4":"41.22034","5":"6.077607","6":"12.240929"},{"1":"21","2":"45","3":"218.68889","4":"47.40924","5":"7.067352","6":"14.243313"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>The output contains the mean weight at each time, number of values (N), standard deviation, standard error, and confidence interval (default 95% unless you change via the <code>conf.interval</code> argument). The output contains information you’ll use for plotting with <code>ggplot</code>.</p>
<p>Plot with within-subjects error bars</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(cw_weight_withinEB, aes(Time, weight)) +
    geom_quasirandom(data = cw, alpha = 0.1) + # this line plots raw data and can be omitted, depending on your plotting
    geom_point() + # add points
    geom_errorbar(aes(ymin = weight - ci, ymax = weight + ci), width = 0) # ymin (lower bound), ymax (upper bound)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-62-1.png" width="624" /></p>
</div>
<p>Note the second line <code>geom_quasirandom(data = cw, alpha = 0.1)</code> adds the raw data to the plot (hence <code>data = cw</code>). Depending your data structure and research questions, you might have to compute your “raw data” for the plot differently before specifying it in <code>geom_quasirandom()</code>.</p>
<p>Plot with between-subjects error bars (WRONG but illustrative purposes)</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(cw, aes(Time, weight)) +
    geom_quasirandom(alpha = 0.1) + # this line plots raw data and can be omitted, depending on your plotting preferences
    stat_summary(fun.y = mean, geom = &#39;point&#39;) + # compute mean and plot
    stat_summary(fun.data = mean_cl_normal, geom = &#39;errorbar&#39;, width = 0) # compute between-sub confidence intervals</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-63-1.png" width="624" /></p>
</div>
<h4 id="mixed-between-within-designs">Mixed (between-within) designs</h4>
<p>Let’s investigate the effects of time (within-subjects) and diet (between-subjects) together.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
cw_weight_mixed &lt;- seWithin(data = cw, measurevar = c(&quot;weight&quot;), 
                            betweenvars = c(&quot;Diet&quot;), withinvars = c(&quot;Time&quot;), 
                            idvar = &quot;Chick&quot;)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Diet"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Time"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["N"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ci"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0","3":"20","4":"41.40000","5":"32.196088","6":"7.199264","7":"15.068233"},{"1":"1","2":"2","3":"20","4":"47.25000","5":"31.222053","6":"6.981463","7":"14.612371"},{"1":"1","2":"4","3":"19","4":"56.47368","5":"28.049332","6":"6.434958","7":"13.519345"},{"1":"1","2":"6","3":"19","4":"66.78947","5":"24.955540","6":"5.725194","7":"12.028185"},{"1":"1","2":"8","3":"19","4":"79.68421","5":"21.023526","6":"4.823128","7":"10.133015"},{"1":"1","2":"10","3":"19","4":"93.05263","5":"14.874487","6":"3.412441","7":"7.169273"},{"1":"1","2":"12","3":"19","4":"108.52632","5":"11.572480","6":"2.654909","7":"5.577757"},{"1":"1","2":"14","3":"18","4":"123.38889","5":"13.870327","6":"3.269267","7":"6.897551"},{"1":"1","2":"16","3":"17","4":"144.64706","5":"21.984518","6":"5.332029","7":"11.303396"},{"1":"1","2":"18","3":"17","4":"158.94118","5":"26.584912","6":"6.447788","7":"13.668700"},{"1":"1","2":"20","3":"17","4":"170.41176","5":"34.320498","6":"8.323943","7":"17.645972"},{"1":"1","2":"21","3":"16","4":"177.75000","5":"38.237769","6":"9.559442","7":"20.375469"},{"1":"2","2":"0","3":"10","4":"40.70000","5":"33.604854","6":"10.626788","7":"24.039464"},{"1":"2","2":"2","3":"10","4":"49.40000","5":"33.861652","6":"10.707994","7":"24.223166"},{"1":"2","2":"4","3":"10","4":"59.80000","5":"32.265022","6":"10.203096","7":"23.081006"},{"1":"2","2":"6","3":"10","4":"75.40000","5":"29.958647","6":"9.473756","7":"21.431125"},{"1":"2","2":"8","3":"10","4":"91.70000","5":"19.417095","6":"6.140224","7":"13.890153"},{"1":"2","2":"10","3":"10","4":"108.50000","5":"10.777143","6":"3.408032","7":"7.709503"},{"1":"2","2":"12","3":"10","4":"131.30000","5":"11.275312","6":"3.565567","7":"8.065872"},{"1":"2","2":"14","3":"10","4":"141.90000","5":"15.284023","6":"4.833232","7":"10.933531"},{"1":"2","2":"16","3":"10","4":"164.70000","5":"22.990849","6":"7.270345","7":"16.446662"},{"1":"2","2":"18","3":"10","4":"187.70000","5":"33.389549","6":"10.558702","7":"23.885444"},{"1":"2","2":"20","3":"10","4":"205.60000","5":"41.917684","6":"13.255536","7":"29.986105"},{"1":"2","2":"21","3":"10","4":"214.70000","5":"50.885426","6":"16.091385","7":"36.401241"},{"1":"3","2":"0","3":"10","4":"40.80000","5":"28.276080","6":"8.941682","7":"20.227489"},{"1":"3","2":"2","3":"10","4":"50.40000","5":"27.594930","6":"8.726283","7":"19.740223"},{"1":"3","2":"4","3":"10","4":"62.20000","5":"26.660100","6":"8.430664","7":"19.071487"},{"1":"3","2":"6","3":"10","4":"77.90000","5":"23.431511","6":"7.409694","7":"16.761893"},{"1":"3","2":"8","3":"10","4":"98.40000","5":"17.857046","6":"5.646894","7":"12.774161"},{"1":"3","2":"10","3":"10","4":"117.10000","5":"12.021922","6":"3.801665","7":"8.599965"},{"1":"3","2":"12","3":"10","4":"144.40000","5":"11.947923","6":"3.778265","7":"8.547029"},{"1":"3","2":"14","3":"10","4":"164.50000","5":"12.590895","6":"3.981591","7":"9.006984"},{"1":"3","2":"16","3":"10","4":"197.40000","5":"19.229222","6":"6.080814","7":"13.755756"},{"1":"3","2":"18","3":"10","4":"233.10000","5":"32.170338","6":"10.173154","7":"23.013273"},{"1":"3","2":"20","3":"10","4":"258.90000","5":"40.861992","6":"12.921696","7":"29.230908"},{"1":"3","2":"21","3":"10","4":"270.30000","5":"48.717298","6":"15.405762","7":"34.850255"},{"1":"4","2":"0","3":"10","4":"41.00000","5":"17.382195","6":"5.496733","7":"12.434473"},{"1":"4","2":"2","3":"10","4":"51.80000","5":"16.818054","6":"5.318336","7":"12.030911"},{"1":"4","2":"4","3":"10","4":"64.50000","5":"17.046321","6":"5.390520","7":"12.194203"},{"1":"4","2":"6","3":"10","4":"83.90000","5":"17.247248","6":"5.454059","7":"12.337938"},{"1":"4","2":"8","3":"10","4":"105.60000","5":"16.883489","6":"5.339028","7":"12.077720"},{"1":"4","2":"10","3":"10","4":"126.00000","5":"16.639228","6":"5.261786","7":"11.902987"},{"1":"4","2":"12","3":"10","4":"151.40000","5":"12.808176","6":"4.050301","7":"9.162417"},{"1":"4","2":"14","3":"10","4":"161.80000","5":"9.155805","6":"2.895320","7":"6.549668"},{"1":"4","2":"16","3":"10","4":"182.00000","5":"11.204764","6":"3.543258","7":"8.015406"},{"1":"4","2":"18","3":"10","4":"202.90000","5":"19.553833","6":"6.183465","7":"13.987970"},{"1":"4","2":"20","3":"9","4":"233.88889","5":"29.101735","6":"9.700578","7":"22.369574"},{"1":"4","2":"21","3":"9","4":"238.55556","5":"34.977292","6":"11.659097","7":"26.885927"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<aside>
We’ve averaged over the <code>Chick</code> variable. Each row (one Diet, one Time) now refers to the mean weight of all the chicks for a particular Diet and Time.
</aside>
<p>Now your summary output has the <code>Diet</code> column.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
ggplot(cw_weight_mixed, aes(Time, weight, col = as.factor(Diet))) + # Diet is numeric but we want it to be a factor/categorical variable
    geom_quasirandom(data = cw, alpha = 0.3, dodge = 0.7) + # this line plots raw data and can be omitted, depending on your plotting
    geom_point(position = position_dodge(0.7), size = 2.5) + # add points
    geom_errorbar(aes(ymin = weight - ci, ymax = weight + ci), width = 0, position = position_dodge(0.7), size = 1) + # ymin (lower bound), ymax (upper bound)
    labs(col = &quot;Diet&quot;)</code></pre>
<p><img src="0003_ggplot_modelfitting_files/figure-html5/unnamed-chunk-66-1.png" width="624" /></p>
</div>
<h2 id="support-my-work">Support my work</h2>
<p><a href="https://donorbox.org/support-my-teaching">Support my work and become a patron here</a>!</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/hauselin/rtutorialsite/issues/new">create an issue</a> on the source repository.</p>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Source code is available at <a href="https://github.com/hauselin/rtutorialsite">https://github.com/hauselin/rtutorialsite</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="radix-site-nav radix-site-footer">
<p>Created and managed by <a href="mailto:hauselin@gmail.com">Hause Lin</a></p>
<p>Created with <a href="https://rstudio.github.io/radix/" target="_blank" rel="noopener noreferrer">Radix</a> in <a href="https://www.rstudio.com/" target="_blank" rel="noopener noreferrer">RStudio</a></p>
</div>
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
